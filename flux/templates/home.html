{% extends "base.html" %}
{% load static %}
{% block title %}FLUX â€¢ Home{% endblock %}

{% block content %}

<!-- NAVBAR -->
<header class="navbar">
  <div class="nav-left">
    <a href="{% url 'home' %}" class="logo">FLUX</a>
  </div>

  <div class="nav-right">

    {% if not user.is_authenticated %}
    <div class="auth-actions">
      <a href="{% url 'signup' %}" class="btn-secondary">Sign up</a>
      <a href="{% url 'login' %}" class="btn-primary">Login</a>
    </div>
    {% endif %}

    {% if user.is_authenticated %}
    <a href="{% url 'cart' %}" class="cart-icon" title="Cart">
      ğŸ›’ <span id="cartCount" class="cart-badge"></span>
    </a>
    {% endif %}

    <div class="theme-switch">
      <input type="checkbox" id="themeToggle" />
      <label for="themeToggle"></label>
    </div>

    {% if user.is_authenticated %}
    <div class="profile-wrapper" id="profileWrapper">
      <div class="nav-profile" id="profileBtn">
        <img src="{% static 'images/placeholder.png' %}" alt="Profile" />
        <span>{{ user.username }}</span>
        <span class="nav-arrow">â–¾</span>
      </div>

      <div class="profile-menu" id="profileMenu">
        <a href="{% url 'profile' %}">My Profile</a>
        <a href="{% url 'orders' %}">My Orders</a>
        <a href="{% url 'settings' %}">Settings</a>
        <a href="{% url 'logout' %}" class="logout-btn">Logout</a>
      </div>
    </div>
    {% endif %}
  </div>
</header>

<!-- HERO -->
<section class="hero">
  <div class="hero-content">
    <h1>Shop Smarter with <span>FLUX</span></h1>
    <p>Premium tech, everyday essentials, and deals youâ€™ll love.</p>

    <div class="hero-actions">
      <a href="#products" class="btn-primary">Shop Now</a>
      <a href="#" class="btn-secondary" id="browseCategoriesBtn">
        Browse Categories
      </a>
    </div>
  </div>

  <div class="hero-visual">
    <div class="glow-card"></div>
  </div>
</section>

<!-- QUICK FILTERS -->
<section class="quick-filters" id="quickFilters">
  <button class="filter-pill active" data-filter="all">â­ Best Sellers</button>
  <button class="filter-pill" data-filter="trending">ğŸ”¥ Trending</button>
  <button class="filter-pill" data-filter="new">ğŸ†• New Arrivals</button>
  <button class="filter-pill" data-filter="under-2999">ğŸ’¸ Under â‚¹2999</button>
  <button class="filter-pill" data-filter="deals">ğŸ Deals for You</button>
</section>

<!-- MAIN -->
<main class="container">
  <h2 class="section-title" id="products">Featured Products</h2>

  <div class="shop-layout">

    <!-- SIDEBAR -->
    <aside class="category-sidebar">
      <h4>Categories</h4>
      <ul id="categoryList">
        <li class="active" data-category="all">All</li>
        <li data-category="Shoes">Shoes</li>
        <li data-category="Clothing">Clothing</li>
        <li data-category="Electronics">Electronics</li>
        <li data-category="Accessories">Accessories</li>
      </ul>
    </aside>

    <!-- PRODUCTS -->
    <section class="products-section">
      <div class="search-wrapper">
        <input
          type="text"
          id="searchInput"
          placeholder="Search products, categories..."
        />
      </div>

      <!-- IMPORTANT:
           product cards MUST have class="product-card"
           and data-* attributes for Quick Peek
      -->
      <div class="product-grid" id="productGrid">
        <!-- JS renders products here -->
      </div>
    </section>
  </div>
</main>

<!-- ========== QUICK PEEK (NEW) ========== -->

<div id="qpOverlay" class="qp-overlay"></div>

<div id="quickPeek" class="quick-peek">
  <button class="qp-close" id="qpClose">âœ•</button>

  <div class="qp-content">
    <img id="qpImage" src="" alt="Product" />
    <h3 id="qpName"></h3>
    <p class="qp-price">â‚¹<span id="qpPrice"></span></p>
    <p id="qpStock" class="qp-stock"></p>

    <div class="qp-actions">
      <button class="qp-cart">Add to Cart</button>
      <button class="qp-buy">Buy Now</button>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("browseCategoriesBtn");
    const target = document.getElementById("products");

    if (btn && target) {
      btn.addEventListener("click", (e) => {
        e.preventDefault();
        const top = target.getBoundingClientRect().top + window.scrollY - 80;
        window.scrollTo({ top, behavior: "smooth" });
      });
    }
  });
</script>

<script src="{% static 'js/quick-peek.js' %}"></script>
{% endblock %}